<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>産学連携実習マッチングアプリ</title>
    <style>
        .reportview-container {
            background: url("background.jpg") no-repeat center center fixed;
            background-size: cover;
            padding: 20px;
            color: black; /* テキスト色を黒に変更 */
            font-size: 16px; /* フォントサイズを調整 */
        }

        form {
            margin-bottom: 20px;
        }

        #map {
            width: 100%;
            height: 500px;
            margin-top: 20px;
        }
    </style>
</head>

<body>
    <div class="reportview-container">
        <h1>産学連携実習マッチングアプリ</h1>
        <p>これは産学連携実習マッチングのテストアプリです</p>
        <h2>R&Dマネジメント研究室</h2>

        <!-- 検索フォーム -->
        <form id="searchForm">
            <label for="lunch">昼食の提供:</label><br>
            <input type="radio" id="lunchYes" name="lunch" value="あり">
            <label for="lunchYes">あり</label><br>
            <input type="radio" id="lunchNo" name="lunch" value="なし">
            <label for="lunchNo">なし</label><br><br>

            <label for="field">興味のある分野:</label><br>
            <select id="field" name="field">
                <option value="企画">企画</option>
                <option value="開発">開発</option>
                <option value="生産">生産</option>
            </select><br><br>

            <label for="professors">担当教授:</label><br>
            <select id="professors" name="professors" multiple>
                <option value="江面先生">江面先生</option>
                <option value="野口先生">野口先生</option>
                <option value="若木先生">若木先生</option>
                <option value="今泉先生">今泉先生</option>
                <option value="金子先生">金子先生</option>
                <option value="永澤先生">永澤先生</option>
                <option value="李先生">李先生</option>
                <option value="茨木先生">茨木先生</option>
            </select><br><br>

            <label for="interesting">実習の面白さ:</label><br>
            <select id="interesting" name="interesting">
                <option value="1">1 - あまり面白くない</option>
                <option value="2">2 - 少し面白い</option>
                <option value="3">3 - 普通</option>
                <option value="4">4 - 面白い</option>
                <option value="5">5 - 非常に面白い</option>
            </select><br><br>

            <input type="submit" value="会社を検索">
        </form>

        <!-- 選択された会社表示 -->
        <div id="companyInfo" style="display: none;">
            <h3>該当する会社が見つかりました:</h3>
            <select id="selected_company" name="selected_company">
                <option value="" disabled selected>会社を選択してください</option>
            </select>
        </div>

        <!-- 出発地点の入力フォーム -->
        <form id="departureForm">
            <label for="departure">出発地点:</label><br>
            <input type="text" id="departure" name="departure"><br><br>
            <input type="submit" value="出発地点から距離を確認">
        </form>

        <!-- 会社データ表示 -->
        <div id="companyData" style="display: none;">
            <h3>会社データ</h3>
            <ul id="companyDataList">
                <!-- ここに会社データが表示されます -->
            </ul>
        </div>

        <!-- 距離情報とルート情報表示 -->
        <div id="distanceInfo"></div>
        <div id="routeInfo"></div>

        <!-- Google Maps表示用のDIV -->
        <div id="map"></div>
    </div>

    <script>
        var companyData = {
                "川﨑株式会社": {
                    "住所": "新潟県三条市下保内４０１ー１７",
                    "昼食": "あり",
                    "分野": "開発, 企画",
                    "距離": "5 km",
                    "担当教授": "江面先生",
                    "実習時間": "8:30 - 15:30",
                    "面白さ": "3" // 会社ごとの面白さ評価
                },
                "株式会社小林設計": {
                    "住所": "新潟県三条市南新保１５－７",
                    "昼食": "なし",
                    "分野": "企画",
                    "距離": "10 km",
                    "担当教授": "野口先生",
                    "実習時間": "9:00 - 16:00",
                    "面白さ": "4"
                },
                "株式会社齋鐵": {
                    "住所": "新潟県三条市井戸場８４－８",
                    "昼食": "あり",
                    "分野": "生産",
                    "距離": "15 km",
                    "担当教授": "若木先生",
                    "実習時間": "8:15 - 16:15",
                    "面白さ": "5"
                },
                "株式会社三栄製作所": {
                    "住所": "新潟県燕市小池５０７３",
                    "昼食": "なし",
                    "分野": "企画, 開発",
                    "距離": "20 km",
                    "担当教授": "今泉先生",
                    "実習時間": "8:30 - 14:30",
                    "面白さ": "2"
                },
                "株式会社内山熔接工業": {
                    "住所": "新潟県新潟市西蒲区小吉１９３０－１",
                    "昼食": "あり",
                    "分野": "生産",
                    "距離": "20 km",
                    "担当教授": "金子先生",
                    "実習時間": "9:00 - 16:00",
                    "面白さ": "4"
                },
                "株式会社大谷製作所": {
                    "住所": "新潟県燕市吉田下中野１４８３",
                    "昼食": "なし",
                    "分野": "企画, 生産",
                    "距離": "10 km",
                    "担当教授": "李先生",
                    "実習時間": "9:00 - 16:00",
                    "面白さ": "3"
                },
                "株式会社東陽理化学研究所": {
                    "住所": "新潟県西蒲原郡弥彦村大戸７６１－１",
                    "昼食": "なし",
                    "分野": "開発",
                    "距離": "15 km",
                    "担当教授": "永澤先生",
                    "実習時間": "9:00 - 17:00",
                    "面白さ": "5"
                },
                "株式会社プラスワイズ": {
                    "住所": "新潟県三条市柳川新田９９７",
                    "昼食": "あり",
                    "分野": "企画, 開発",
                    "距離": "10 km",
                    "担当教授": "永澤先生",
                    "実習時間": "9:00 - 16:00",
                    "面白さ": "4"
                },
                "株式会社スリーピークス技研": {
                    "住所": "新潟県三条市塚野目２１７１",
                    "昼食": "なし",
                    "分野": "企画, 開発, 生産",
                    "距離": "5 km",
                    "担当教授": "李先生",
                    "実習時間": "9:00 - 16:00",
                    "面白さ": "5"
                },
                "北陸工業株式会社": {
                    "住所": "新潟県三条市吉野屋甲４４５",
                    "昼食": "あり",
                    "分野": "開発, 生産",
                    "距離": "5 km",
                    "担当教授": "茨木先生",
                    "実習時間": "8:45 - 16:00",
                    "面白さ": "3"
                },
                "富士印刷株式会社": {
                    "住所": "新潟県三条市猪子場新田１１２２－１",
                    "昼食": "なし",
                    "分野": "企画, 生産",
                    "距離": "10 km",
                    "担当教授": "李先生",
                    "実習時間": "9:00 - 15:00",
                    "面白さ": "4"
                },
                "株式会社タダフサ": {
                    "住所": "新潟県三条市東本成寺２７－１６",
                    "昼食": "なし",
                    "分野": "開発, 生産",
                    "距離": "10 km",
                    "担当教授": "李先生",
                    "実習時間": "9:00 - 16:00",
                    "面白さ": "2"
                },
                "株式会社ワイヤード": {
                    "住所": "新潟県三条市北新保2丁目４－１５",
                    "昼食": "なし",
                    "分野": "開発, 生産",
                    "距離": "10 km",
                    "担当教授": "李先生",
                    "実習時間": "9:00 - 16:00",
                    "面白さ": "3"
                }
            };

        var companiesMatchingCriteria = []; // 条件に合った会社を格納する配列

        // ページ読み込み時に実行
        document.addEventListener('DOMContentLoaded', function () {
            var searchForm = document.getElementById('searchForm');
            var companyInfo = document.getElementById('companyInfo');
            var selectedCompany = document.getElementById('selected_company');
            var companyDataList = document.getElementById('companyDataList');
            var departureForm = document.getElementById('departureForm');
            var companyDataDiv = document.getElementById('companyData');
            var mapDiv = document.getElementById('map');
            var distanceInfoDiv = document.getElementById('distanceInfo');
            var routeInfoDiv = document.getElementById('routeInfo');

            // 会社検索フォームの送信時の処理
            searchForm.addEventListener('submit', function (event) {
                event.preventDefault(); // フォームのデフォルトの送信を防止

                var lunchOption = document.querySelector('input[name="lunch"]:checked').value;
                var fieldOption = document.getElementById('field').value;
                var professorsOptions = [...document.getElementById('professors').selectedOptions].map(opt => opt.value);
                var interestingOption = document.getElementById('interesting').value;

                // 選択条件に合う会社を抽出
                companiesMatchingCriteria = Object.keys(companyData).filter(function (companyName) {
                    var company = companyData[companyName];
                    return company["昼食"] === lunchOption &&
                        company["分野"].includes(fieldOption) &&
                        professorsOptions.includes(company["担当教授"]) &&
                        parseInt(company["面白さ"]) >= parseInt(interestingOption);
                });

                // 選択肢のセレクトボックスに結果を表示
                selectedCompany.innerHTML = '<option value="" disabled selected>会社を選択してください</option>';
                companiesMatchingCriteria.forEach(function (companyName) {
                    var option = document.createElement('option');
                    option.value = companyName;
                    option.textContent = companyName;
                    selectedCompany.appendChild(option);
                });

                companyInfo.style.display = 'block'; // 会社選択のセクションを表示
                companyDataDiv.style.display = 'none'; // 会社データのセクションを非表示にする
                mapDiv.style.display = 'none'; // マップを非表示にする
                distanceInfoDiv.innerHTML = ''; // 距離情報をクリアする
                routeInfoDiv.innerHTML = ''; // ルート情報をクリアする
            });

            // 会社選択時の処理
            selectedCompany.addEventListener('change', function () {
                var selectedCompanyName = selectedCompany.value;

                if (selectedCompanyName) {
                    var company = companyData[selectedCompanyName];

                    // 会社データを表示
                    companyDataList.innerHTML = '';
                    Object.keys(company).forEach(function (key) {
                        var li = document.createElement('li');
                        li.textContent = `${key}: ${company[key]}`;
                        companyDataList.appendChild(li);
                    });

                    companyDataDiv.style.display = 'block'; // 会社データのセクションを表示
                    mapDiv.style.display = 'block'; // マップを表示

                    // Google Mapsを初期化して表示
                    initMap(company["住所"]);

                    // 実習時間の条件を満たさない場合は警告
                    var time = company["実習時間"];
                    if (!checkTrainingTime(time)) {
                        alert("実習時間が条件を満たしていません。別の会社を選択してください。");
                        selectedCompany.value = ''; // 選択をリセット
                        companyDataDiv.style.display = 'none'; // 会社データのセクションを非表示にする
                        mapDiv.style.display = 'none'; // マップを非表示にする
                        distanceInfoDiv.innerHTML = ''; // 距離情報をクリアする
                        routeInfoDiv.innerHTML = ''; // ルート情報をクリアする
                    }
                }
            });

            // 出発地点フォームの送信時の処理
            departureForm.addEventListener('submit', function (event) {
                event.preventDefault(); // フォームのデフォルトの送信を防止

                var departure = document.getElementById('departure').value;

                // 出発地点が入力されている場合にのみ距離とルートを表示
                if (departure) {
                    var selectedCompanyName = selectedCompany.value;
                    var company = companyData[selectedCompanyName];
                    var companyAddress = company["住所"];

                    // Google Maps APIを使用して距離とルートを計算
                    calculateDistance(departure, companyAddress);
                }
            });

            // Google Mapsを初期化する関数
            function initMap(destinationAddress) {
                var map = new google.maps.Map(document.getElementById('map'), {
                    zoom: 10,
                    center: { lat: 37.7749, lng: -122.4194 } // San Franciscoの座標
                });

                var geocoder = new google.maps.Geocoder();
                geocodeAddress(geocoder, map, destinationAddress);
            }

            // 住所を緯度経度に変換する関数
            function geocodeAddress(geocoder, resultsMap, address) {
                geocoder.geocode({ 'address': address }, function (results, status) {
                    if (status === 'OK') {
                        resultsMap.setCenter(results[0].geometry.location);
                        var marker = new google.maps.Marker({
                            map: resultsMap,
                            position: results[0].geometry.location
                        });
                    } else {
                        alert('Geocode was not successful for the following reason: ' + status);
                    }
                });
            }

            // 実習時間の条件をチェックする関数
            function checkTrainingTime(time) {
                // ここで実習時間の条件を満たしているかどうかを確認するロジックを実装
                // 例: 8:00 - 17:00の間であればtrueを返す
                var startTime = time.split(' - ')[0];
                var endTime = time.split(' - ')[1];
                var startHour = parseInt(startTime.split(':')[0]);
                var endHour = parseInt(endTime.split(':')[0]);
                return startHour >= 8 && endHour <= 17; // 例として、8時から17時の間を満たすという条件を追加
            }

            // 距離とルートを計算する関数
            function calculateDistance(origin, destination) {
                var service = new google.maps.DistanceMatrixService();
                service.getDistanceMatrix(
                    {
                        origins: [origin],
                        destinations: [destination],
                        travelMode: 'DRIVING',
                    },
                    function (response, status) {
                        if (status !== 'OK') {
                            alert('Error was: ' + status);
                        } else {
                            var distanceText = response.rows[0].elements[0].distance.text;
                            var durationText = response.rows[0].elements[0].duration.text;
                            distanceInfoDiv.innerHTML = '距離: ' + distanceText + '<br>所要時間: ' + durationText;

                            // ルート情報を表示
                            var directionsService = new google.maps.DirectionsService();
                            var directionsRenderer = new google.maps.DirectionsRenderer();
                            directionsRenderer.setMap(map);

                            var request = {
                                origin: origin,
                                destination: destination,
                                travelMode: 'DRIVING'
                            };
                            directionsService.route(request, function (result, status) {
                                if (status == 'OK') {
                                    directionsRenderer.setDirections(result);
                                }
                            });
                        }
                    }
                );
            }
        });
    </script>
    <script async defer
        src="https://maps.googleapis.com/maps/api/js?key=AIzaSyC8E0eIwP5JLXT5IWIDJiLqlhM8fh9qLOw&libraries=places&callback=initMap">
    </script>
</body>

</html>



